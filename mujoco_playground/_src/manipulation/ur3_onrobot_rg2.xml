<mujoco model="ur3_onrobot_rg2_cube">

  <compiler angle="radian" meshdir="meshes/" autolimits="true"/>
  <statistic center="0 0 0.5" extent="1.5"/>

  <asset>
    <material name="ur_grey" rgba="0.7 0.7 0.7 1"/>
    <material name="gripper_grey" rgba="0.8 0.8 0.8 1"/>
    <material name="fingertip_black" rgba="0.1 0.1 0.1 1"/>
    <mesh name="v_base"     file="visual/v_base.stl"/>
    <mesh name="v_shoulder" file="visual/v_shoulder.stl"/>
    <mesh name="v_upperarm" file="visual/v_upperarm.stl"/>
    <mesh name="v_forearm"  file="visual/v_forearm.stl"/>
    <mesh name="v_wrist1"   file="visual/v_wrist1.stl"/>
    <mesh name="v_wrist2"   file="visual/v_wrist2.stl"/>
    <mesh name="v_wrist3"   file="visual/v_wrist3.stl"/>
    <mesh name="v_gripper_base" file="visual/v_base_link.stl"/>
    <mesh name="v_outer_knuckle" file="visual/v_outer_knuckle.stl"/>
    <mesh name="v_inner_knuckle" file="visual/v_inner_knuckle.stl"/>
    <mesh name="v_inner_finger"  file="visual/v_inner_finger.stl"/>
    <mesh name="c_base"     file="collision/c_base.stl"/>
    <mesh name="c_shoulder" file="collision/c_shoulder.stl"/>
    <mesh name="c_upperarm" file="collision/c_upperarm.stl"/>
    <mesh name="c_forearm"  file="collision/c_forearm.stl"/>
    <mesh name="c_wrist1"   file="collision/c_wrist1.stl"/>
    <mesh name="c_wrist2"   file="collision/c_wrist2.stl"/>
    <mesh name="c_wrist3"   file="collision/c_wrist3.stl"/>
    <mesh name="c_gripper_base" file="collision/c_base_link.stl"/>
    <mesh name="c_outer_knuckle" file="collision/c_outer_knuckle.stl"/>
    <mesh name="c_inner_knuckle" file="collision/c_inner_knuckle.stl"/>
    <mesh name="c_inner_finger"  file="collision/c_inner_finger.stl"/>

    <texture name="tex_checker" type="2d" builtin="checker" rgb1="0.8 0.8 0.8" rgb2="0.9 0.9 0.9" width="300" height="300"/>
    
    <material name="mat_checker" texture="tex_checker"/>

    <material name="mat_red_cube" rgba="1 0 0 1"/>
    </asset>

  <default>
    <default class="ur_joint">
      <joint armature="0.5" damping="10"/>
    </default>
    
    <default class="rg2_joint">
      <joint armature="0.2" damping="1.0"/>
    </default>

    <default class="collision">
      <geom type="mesh" contype="1" conaffinity="1" group="3" rgba="0.5 0.6 0.7 0.3"/>
    </default>
    <default class="ur_visual">
      <geom type="mesh" contype="0" conaffinity="0" group="2" material="ur_grey"/>
    </default>
    <default class="gripper_visual">
      <geom type="mesh" contype="0" conaffinity="0" group="2" material="gripper_grey"/>
    </default>
    <default class="fingertip_visual">
      <geom type="mesh" contype="0" conaffinity="0" group="2" material="fingertip_black"/>
    </default>
  </default>

  <worldbody>
    <light directional="true" pos="0 0 4" dir="0 0 -1" castshadow="false"/>

    <geom name="floor" type="plane" size="5 5 0.1" material="mat_checker" 
      pos="0 0 0" quat="1 0 0 0" contype="1" conaffinity="1"/>
    <geom class="ur_visual" mesh="v_base" quat="-1 0 0 0"/>
   	<geom class="collision" mesh="c_base" quat="-1 0 0 0"/>
    

    <body name="shoulder_link" pos="0 0 0.1519" quat="0 0 0 1">
      <inertial pos="0 0 -0.02" mass="2" diaginertia="0.00809317 0.00809317 0.005625"/>
      <joint name="shoulder_pan_joint" class="ur_joint" pos="0 0 0" range="-6.28319 6.28319" axis="0 0 1"/>
      <geom class="ur_visual" mesh="v_shoulder" quat="0 0 0 1"/>
   	  <geom class="collision" mesh="c_shoulder" quat="0 0 0 1"/>
      
      <body name="upper_arm_link" quat="0.707107 0.707107 0 0">
        <inertial pos="-0.11365 0 0.1157" mass="3.42" diaginertia="0.0217285 0.0217285 0.00961875"/>
        <joint name="shoulder_lift_joint" class="ur_joint" pos="0 0 0" range="-6.28319 6.28319" axis="0 0 1"/>
        <geom class="ur_visual" mesh="v_upperarm" pos="0 0 0.1198" quat="0.5 0.5 -0.5 -0.5"/>
        <geom class="collision" mesh="c_upperarm" pos="0 0 0.1198" quat="0.5 0.5 -0.5 -0.5"/>
        
        <body name="forearm_link" pos="-0.24365 0 0">
          <inertial pos="-0.16325 0 0.0238" mass="1.26" diaginertia="0.00654681 0.00654681 0.00354375"/>
          <joint name="elbow_joint" class="ur_joint" pos="0 0 0" range="-3.14159 3.14159" axis="0 0 1"/>
          <geom class="ur_visual" mesh="v_forearm" pos="0 0 0.0275" quat="0.5 0.5 -0.5 -0.5"/>
          <geom class="collision" mesh="c_forearm" pos="0 0 0.0275" quat="0.5 0.5 -0.5 -0.5"/>
          
          <body name="wrist_1_link" pos="-0.21325 0 0.11235">
            <inertial pos="0 -0.01 0" quat="0.5 0.5 -0.5 0.5" mass="0.8" diaginertia="0.00225 0.00161064 0.00161064"/>
            <joint name="wrist_1_joint" class="ur_joint" pos="0 0 0" range="-6.28319 6.28319" axis="0 0 1"/>
            <geom class="ur_visual" mesh="v_wrist1" pos="0 0 -0.085" quat="0.707107 0.707107 0 0"/>
            <geom class="collision" mesh="c_wrist1" pos="0 0 -0.085" quat="0.707107 0.707107 0 0"/>
            
            <body name="wrist_2_link" pos="0 -0.08535 -1.75056e-11" quat="0.707107 0.707107 0 0">
              <inertial pos="0 0.01 0" quat="0.5 0.5 -0.5 0.5" mass="0.8" diaginertia="0.00225 0.00157217 0.00157217"/>
              <joint name="wrist_2_joint" class="ur_joint" pos="0 0 0" range="-6.28319 6.28319" axis="0 0 1"/>
              <geom class="ur_visual" mesh="v_wrist2" pos="0 0 -0.083" quat="1 0 0 0"/>
              <geom class="collision" mesh="c_wrist2" pos="0 0 -0.083" quat="1 0 0 0"/>
              
              <body name="wrist_3_link" pos="0 0.0819 -1.6798e-11" quat="0.707107 -0.707107 0 0">
                <inertial pos="0 0 -0.00666667" quat="0.923792 0.00525909 -0.0126966 0.382647" mass="1.05" diaginertia="0.00123064 0.0012286 0.00117916"/>
                <joint name="wrist_3_joint" class="ur_joint" pos="0 0 0" range="-6.28319 6.28319" axis="0 0 1"/>
                <geom class="ur_visual" mesh="v_wrist3" pos="0 -0.00255 -0.082" quat="0.707107 0.707107 0 0"/>
                <geom class="collision" mesh="c_wrist3" pos="0 -0.00255 -0.082" quat="0.707107 0.707107 0 0"/>
                
                <site name="pinch_site" pos="0 0 0.195" size="0.005" rgba="1 0 0 1" group="2"/>

                <geom class="gripper_visual" mesh="v_gripper_base"/>
                <geom class="collision" mesh="c_gripper_base"/>
                
                <body name="left_outer_knuckle" pos="0 -0.017178 0.125797" quat="1 0 0 0">
                  <inertial pos="0 0 0" quat="0.820473 0.339851 -0.17592 0.424708" mass="0.05" diaginertia="0.001002 0.000999 0.000999"/>
                  <joint name="finger_joint" class="rg2_joint" pos="0 0 0" axis="-1 0 0" range="-0.558505 0.785398"/>
                  <geom class="gripper_visual" mesh="v_outer_knuckle"/>
                  <geom class="collision" mesh="c_outer_knuckle"/>
                  <body name="left_inner_finger" pos="0 -0.039592 0.038177">
                    <inertial pos="0 0 0" quat="0.820473 0.339851 -0.17592 0.424708" mass="0.05" diaginertia="0.001002 0.000999 0.000999"/>
                    <joint name="left_inner_finger_joint" class="rg2_joint" pos="0 0 0" axis="1 0 0" range="-0.872665 0.872665"/>
                    <geom class="fingertip_visual" mesh="v_inner_finger"/>
                    <geom name="left_pad" class="collision" mesh="c_inner_finger"/>
                  </body>
                </body>
                
                <body name="left_inner_knuckle" pos="0 -0.007678 0.142297" quat="1 0 0 0">
                  <inertial pos="0 0 0" quat="0.820473 0.339851 -0.17592 0.424708" mass="0.05" diaginertia="0.001002 0.000999 0.000999"/>
                  <joint name="left_inner_knuckle_joint" class="rg2_joint" pos="0 0 0" axis="1 0 0" range="-0.785398 0.785398"/>
                  <geom class="gripper_visual" mesh="v_inner_knuckle"/>
                  <geom class="collision" mesh="c_inner_knuckle"/>
                </body>
                
                <body name="right_outer_knuckle" pos="0 0.017178 0.125797" quat="0 0 0 1">
                  <inertial pos="0 0 0" quat="0.820473 0.339851 -0.17592 0.424708" mass="0.05" diaginertia="0.001002 0.000999 0.000999"/>
                  <joint name="right_outer_knuckle_joint" class="rg2_joint" pos="0 0 0" axis="1 0 0" range="-0.785398 0.785398"/>
                  <geom class="gripper_visual" mesh="v_outer_knuckle"/>
                  <geom class="collision" mesh="c_outer_knuckle"/>
                  <body name="right_inner_finger" pos="0 -0.039592 0.038177">
                    <inertial pos="0 0 0" quat="0.820473 0.339851 -0.17592 0.424708" mass="0.05" diaginertia="0.001002 0.000999 0.000999"/>
                    <joint name="right_inner_finger_joint" class="rg2_joint" pos="0 0 0" axis="1 0 0" range="-0.872665 0.872665"/>
                    <geom class="fingertip_visual" mesh="v_inner_finger"/>
                    <geom name="right_pad" class="collision" mesh="c_inner_finger"/>
                  </body>
                </body>
                <body name="right_inner_knuckle" pos="0 0.007678 0.142297" quat="0 0 0 -1">
                  <inertial pos="0 0 0" quat="0.820473 0.339851 -0.17592 0.424708" mass="0.05" diaginertia="0.001002 0.000999 0.000999"/>
                  <joint name="right_inner_knuckle_joint" class="rg2_joint" pos="0 0 0" axis="1 0 0" range="-0.785398 0.785398"/>
                  <geom class="gripper_visual" mesh="v_inner_knuckle"/>
                  <geom class="collision" mesh="c_inner_knuckle"/>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
    <!-- Box -->
    <body name="object_box" pos="0.5 0 0.4"> <freejoint name="box_joint"/>
      <geom name="box_geom" type="box" 
            size="0.025 0.025 0.025" material="mat_red_cube" 
            mass="0.1" contype="1" conaffinity="1"/>
    </body>
    <!-- Target -->
    <body name="mocap_target" pos="0.5 0 0.5" mocap="true">
        <geom type="sphere" size="0.02" rgba="0 1 1 0.5" contype="0" conaffinity="0"/>
    </body>
    </worldbody>

  <contact>
    <exclude body1="world" body2="shoulder_link"/>
  </contact>

  <actuator>
     	<position name="pos_shoulder_pan"  joint="shoulder_pan_joint"    kp="100" forcelimited="true" forcerange="-54 54" ctrlrange="-6.28319 6.28319"/>
     	<position name="pos_shoulder_lift" joint="shoulder_lift_joint"   kp="100" forcelimited="true" forcerange="-54 54" ctrlrange="-6.28319 6.28319"/>
     	<position name="pos_elbow" 		  joint="elbow_joint" 		  kp="50"  forcelimited="true" forcerange="-28 28" ctrlrange="-3.14159 3.14159"/>
     	<position name="pos_wrist_1" 	  joint="wrist_1_joint" 	  kp="20"  forcelimited="true" forcerange="-9 9"   ctrlrange="-6.28319 6.28319"/>
     	<position name="pos_wrist_2" 	  joint="wrist_2_joint" 	  kp="20"  forcelimited="true" forcerange="-9 9"   ctrlrange="-6.28319 6.28319"/>
     	<position name="pos_wrist_3" 	  joint="wrist_3_joint" 	  kp="20"  forcelimited="true" forcerange="-9 9"   ctrlrange="-6.28319 6.28319"/>
     	<position name="pos_finger" joint="finger_joint" kp="10" forcelimited="true" forcerange="-1000 1000" ctrlrange="-0.558505 0.785398"/>
   </actuator>

  <equality>
    <joint joint1="finger_joint" joint2="right_outer_knuckle_joint" polycoef="0 -1 0 0 0" solimp="0.9 0.95 0.001" solref="0.01 1"/>
    <joint joint1="finger_joint" joint2="left_inner_knuckle_joint"  polycoef="0 -1 0 0 0" solimp="0.9 0.95 0.001" solref="0.01 1"/>
    <joint joint1="finger_joint" joint2="right_inner_knuckle_joint" polycoef="0 -1 0 0 0" solimp="0.9 0.95 0.001" solref="0.01 1"/>
    <joint joint1="finger_joint" joint2="left_inner_finger_joint"   polycoef="0 1 0 0 0" solimp="0.9 0.95 0.001" solref="0.01 1"/>
    <joint joint1="finger_joint" joint2="right_inner_finger_joint"  polycoef="0 1 0 0 0" solimp="0.9 0.95 0.001" solref="0.01 1"/>
  </equality>

  <keyframe>
    <key name="home" qpos="-1.57 -1.57 1.57 -1.57 -1.57 0 0 0.5 0 0.4 1 0 0 0" ctrl="-1.57 -1.57 1.57 -1.57 -1.57 0 0"/>
  </keyframe>

</mujoco>